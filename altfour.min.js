(function(){var e=this,t="altfourjs",n=function(e){this.supported=null,this.namespace=e};n.prototype={isSupported:function(){if(this.supported===null){var e,t,n;e=new Date;try{(t=window.localStorage).setItem(e,e),n=t.getItem(e)==e,t.removeItem(e),this.supported=n&&t}catch(r){this.supported=!1}}return this.supported},add:function(e){this.isSupported()&&localStorage.setItem(this.namespace,JSON.stringify(e))},get:function(){return this.isSupported()?JSON.parse(localStorage.getItem(this.namespace)):null}};var r=function(e){this.collectors=[],this.removeCallback=e};r.prototype={add:function(e,t){var n=this;t-=(new Date).getTime(),this.remove(e),t<=0?this.expire(e):this.collectors[e]=setTimeout(function(){n.expire.apply(n,[e])},t)},remove:function(e){clearTimeout(this.collectors[e]),delete this.collectors[e]},expire:function(e){this.removeCallback(e)}};var i=function(e){this.message=e};i.prototype=new Error,i.prototype.name="Cache Exception",i.prototype.toString=function(){return this.name+": "+this.message};var s=function(e){var i=this;e?this.namespace=t+"-"+e:this.namespace=t,this.localStorage=new n(this.namespace),this.garbageCollector=new r(function(e){delete i.storage[e],i.saveToLocalStorage()}),this.stats={misses:0,hits:0,total:0},this.retrieveFromLocalStorage(),this.storage?this.initGcs():this.storage={}};s.prototype={add:function(e,t,n){return n?(n=(new Date).getTime()+n,this.garbageCollector.add(e,n)):(n=0,this.garbageCollector.remove(e)),this.storage[e]={item:t,expiry:n},this.saveToLocalStorage(),this},get:function(e,t){var n,r;r=(new Date).getTime(),this.stats.total++;if(this.storage[e]){n=this.storage[e];if(!n.expiry||n.expiry&&n.expiry>=r)return this.stats.hits++,n.item;n.expiry&&n.expiry<r&&(this.storage[e]=null,this.saveToLocalStorage())}else if(t){var i;i=t(e,this);if(i!==undefined)return this.add(e,i,0),this.stats.hits++,this.get(e)}return this.stats.misses++,undefined},remove:function(e){return this.storage[e]!==undefined&&(delete this.storage[e],this.garbageCollector.remove(e)),this.saveToLocalStorage(),this},clear:function(){return this.storage={},this.saveToLocalStorage(),this},saveToLocalStorage:function(){this.localStorage.add(this.storage)},retrieveFromLocalStorage:function(){this.storage=this.localStorage.get()},initGcs:function(){for(var e in this.storage){var t=this.storage[e];t.expiry&&this.garbageCollector.add(e,t.expiry)}}},e.Cache=e.Cache||s})();